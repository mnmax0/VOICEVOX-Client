#c| Cchange  話速:1.4
#c| set _y   話者:四国めたん タイプ:あまあま 話速:1.4 音高:0.0 抑揚:1.0 音量:1.0 開始無音:0.1 終了無音:0.1
#c| set _z   話者:ずんだもん タイプ:あまあま 話速:1.4 音高:0.0 抑揚:1.0 音量:1.0 開始無音:0.1 終了無音:0.1
こんにちはNM Maxです
#c| print PicoちゃんMicroPython入門サイト https://projects.raspberrypi.org/en/projects/get-started-pico-w
Pico W用のGetting Started のソースを改造して、DHT11の温度、湿度をネットワーク越しにデータ取るのに成功しました。
ボタンを2つ追加しました。
このボタンを押すとその時のデータを計測しセーブします。
ほっといたら、ファイルにデータを5分ごとに落としてるんですけども、このボタンでそのファイルを消せるようにしました。
#c| newChapter
この真ん中の2つのLED操作ボタンは、元からあったもので、消してません。
#c| newChapter
この2つの表示も、元からあったやつで、その下が今回追加したコードで生成してます。
#c| newChapter
測定した日時、DHT11で計測した温度と湿度データ,ピコに標準で内部の温度が並んでます。
#c| newChapter
ピコ内部の温度計と、DHT11の温度は5度程度違ってます。発熱してるから？よく理由はわかりません。
#c| newChapter
プログラムのどこを改造したのかが、これです。左が新しいプログラム、右が元のプログラムになります。色ついてるところが変更したり、追加したコードになります。
#c| newChapter
DHTモジュールOSモジュールをインポートしてます。osモジュールは、ファイル消したり、ファイルが存在してるかの確認するのに使ってます。
#c| newChapter
時間割り込み使ってデータを取ってファイル保存いうのやってまして。保存するファイル名ですね、ここで定義してます。
#c| newChapter
どのくらいの時間間隔で割り込みかけるかを、この変数で定義してて、単位はミリ秒です。今は5分にしてます。
#c| newChapter
割り込みがかかると呼び出される関数がこの関数です。
#c| newChapter
まず内部LEDを消えてたらつけて、ついてたら消す処理をしてます。測定してるのがわかりやすいように。
#c| newChapter
ファイルを開いて取ってきたデータをカンマ区切りで保存するようにしてます。最後に改行マークをつけてます。
#c| newChapter
その時間割り込みのやつをどうやるかって指示してるのが、この行になります。
#c| newChapter
リアルタイムクロックのオブジェクトを作って,現在日時を文字列にしてかえす関数がこれで、測定時に利用してます。
#c| newChapter
myDHT11っていう関数が計測して、ファイルに追加する処理になってます。かえすデータはDHT11の温度、湿度、最後にピコ内部の温度センサーの値もかえすようにしてます。
#c| newChapter
この２行は、Wifiのネットワーク名とパスワードにしてます。セキュリティの関係で、ここでは私の実際使ってるのは貼ってません。
#c| newChapter
Picoは2.4Gしか多分対応してないので、つなぐWifiは2.4Gの設定にしてください。
#c| newChapter
リダイレクトするまでの時間と、データ用の引数が追加されてます。
#c| newChapter
ウェブページの中身変えてますヘッダーつけて、日本語が文字化けしないようにと、自動で再読込するようにしてます。操作したときは、ルートディレクトリに5秒後に戻るように改造してます。
#c| newChapter
ボタンも２つ追加してて、押すと測定して、そのデータをファイルに追加するボタン。押すとデータ保存ファイルを消すボタンです。
#c| newChapter
その後は、データの見出し。そしてデータを表示するようにかえてます。 データ数が131くらいで、きれちゃうので、最新の50個を表示するように改造しました。そうなる原因はまだ調査中です。
#c| newChapter
現状だと、全部のデータはパソコンにつないで、Thonny利用でデータファイルを開くと全部みれます。
全部をネットこしに見れるようにする。データファイルをネットごしに取れるようにするとか。内部センサーの値、正確じゃないのに桁数おおすぎで、無駄なので、四捨五入するとか。グラフ表示させる。などなど。かなり改良の余地あるのですが、今回はここまでにしようと思います。また改良したら動画にするかも、しないかも。
今回はタイマー割り込みをつかって５分毎にデータ取るっていうのと、取得したデータの一部をネットごしにみれるようにしてみました。
それでは、またね！
